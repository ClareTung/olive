# 性能优化衡量指标和注意点

## 衡量指标

* 大体上分为：性能指标、响应时间、并发量、秒开率和正确性等。

## 性能指标

* 性能指标又可以包含：吞吐量和响应速度。
* 我们平时所说的QPS、TPS和HPS等，就可以归结为吞吐量。
  * QPS代表的是每秒的查询数量
  * TPS代表的是每秒实物的数量
  * HPS代表的是每秒的HTTP请求数量
* 优化性能也并不是一味的优化吞吐量和优化响应速度，而是在吞吐量和响应速度之间找到一个平衡点，使用有限的服务资源来更好的提升用户体验

## 响应时间

* 平均响应时间：体现的是服务接口的平均处理能力。
  * 计算方式就是把所有的请求所耗费的时间加起来，然后除以请求的次数。
  * 无法很好的体现出波动性。
* 百分位数：就是我们在优化的时候，圈定一个时间范围，把每次请求的耗时加入一个列表中，然后按照从小到大的顺序将这些时间进行排序。这样，我们取出特定百分位的耗时，这个数字就是 TP 值。
  * TP值表示的含义就是：超过 N% 的请求都在 X 时间内返回。比如 TP90 = 50ms，意思是超过 90%的请求，都在 50ms 内返回。
  *  反映的是接口整体响应情况

## 并发量

* 并发量指的是系统能够同时处理的请求数量，反映的是系统的负载能力。

## 秒开率

* 秒开率主要针对的是前端网页或者移动端APP来说的，响应时间超过3秒甚至更长时间，用户就有可能直接退出或者不再使用。

## 正确性

* 正确性说的是无论我们以何种方式，何种手段对应用进行优化，优化后的交互数据结果必须是正确的。不能出现优化前性能比较低，数据正确，而优化后性能比较高，反而数据不正确的现象。

## 优化需要注意的问题

* 除非必要,一开始不要优化(尤其是开发阶段)
* 有些优化准则已经过时,需要考虑当下的软硬件环境(不要墨守成规)
* 不要过分强调某些系统级指标,如cache 命中率,而应该聚焦性能瓶颈点
* 不盲从，测试、找到系统的性能瓶颈，再确定优化手段
* 注意权衡优化的成本和收益（有些优化可能需要现有架构做出调整、增加开发/运维成本）
* 优化的目标是用户体验、降低硬件成本（降低集群规模、不依赖单机高性能）
* 测试环境的优化手段未必对生产环境有效（优化需要针对真实情况）

